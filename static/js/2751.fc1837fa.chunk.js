"use strict";(self.webpackChunksemantic_composer=self.webpackChunksemantic_composer||[]).push([[2751],{2751:(e,t,i)=>{i.d(t,{defineFeature:()=>x});var o=i(7184),r=i(8115);class s{constructor(e,t){var i;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(i=t.width)&&void 0!==i?i:1,this.color=!1===t.color?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map((t=>{let i=e=>{this[t](e)};return e.dom.addEventListener(t,i),{name:t,handler:i}}))}destroy(){this.handlers.forEach((e=>{let{name:t,handler:i}=e;return this.editorView.dom.removeEventListener(t,i)}))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e,t=this.editorView.state.doc.resolve(this.cursorPos),i=!t.parent.inlineContent;if(i){let i=t.nodeBefore,o=t.nodeAfter;if(i||o){let t=this.editorView.nodeDOM(this.cursorPos-(i?i.nodeSize:0));if(t){let r=t.getBoundingClientRect(),s=i?r.bottom:r.top;i&&o&&(s=(s+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),e={left:r.left,right:r.right,top:s-this.width/2,bottom:s+this.width/2}}}}if(!e){let t=this.editorView.coordsAtPos(this.cursorPos);e={left:t.left-this.width/2,right:t.left+this.width/2,top:t.top,bottom:t.bottom}}let o,r,s=this.editorView.dom.offsetParent;if(this.element||(this.element=s.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",i),this.element.classList.toggle("prosemirror-dropcursor-inline",!i),!s||s==document.body&&"static"==getComputedStyle(s).position)o=-pageXOffset,r=-pageYOffset;else{let e=s.getBoundingClientRect();o=e.left-s.scrollLeft,r=e.top-s.scrollTop}this.element.style.left=e.left-o+"px",this.element.style.top=e.top-r+"px",this.element.style.width=e.right-e.left+"px",this.element.style.height=e.bottom-e.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.setCursor(null)),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),i=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),o=i&&i.type.spec.disableDropCursor,s="function"==typeof o?o(this.editorView,t,e):o;if(t&&!s){let e=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let t=(0,r.Um)(this.editorView.state.doc,e,this.editorView.dragging.slice);null!=t&&(e=t)}this.setCursor(e),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){e.target!=this.editorView.dom&&this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}var n=i(4526),l=i(4282),d=i(1140);class a extends o.LN{constructor(e){super(e,e)}map(e,t){let i=e.resolve(t.map(this.head));return a.valid(i)?new a(i):o.LN.near(i)}content(){return l.Ji.empty}eq(e){return e instanceof a&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new a(e.resolve(t.pos))}getBookmark(){return new c(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!function(e){for(let t=e.depth;t>=0;t--){let i=e.index(t),o=e.node(t);if(0!=i)for(let e=o.child(i-1);;e=e.lastChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(o.type.spec.isolating)return!0}return!0}(e)||!function(e){for(let t=e.depth;t>=0;t--){let i=e.indexAfter(t),o=e.node(t);if(i!=o.childCount)for(let e=o.child(i);;e=e.firstChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(o.type.spec.isolating)return!0}return!0}(e))return!1;let i=t.type.spec.allowGapCursor;if(null!=i)return i;let o=t.contentMatchAt(e.index()).defaultType;return o&&o.isTextblock}static findGapCursorFrom(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e:for(;;){if(!i&&a.valid(e))return e;let r=e.pos,s=null;for(let i=e.depth;;i--){let o=e.node(i);if(t>0?e.indexAfter(i)<o.childCount:e.index(i)>0){s=o.child(t>0?e.indexAfter(i):e.index(i)-1);break}if(0==i)return null;r+=t;let n=e.doc.resolve(r);if(a.valid(n))return n}for(;;){let n=t>0?s.firstChild:s.lastChild;if(!n){if(s.isAtom&&!s.isText&&!o.nh.isSelectable(s)){e=e.doc.resolve(r+s.nodeSize*t),i=!1;continue e}break}s=n,r+=t;let l=e.doc.resolve(r);if(a.valid(l))return l}return null}}}a.prototype.visible=!1,a.findFrom=a.findGapCursorFrom,o.LN.jsonID("gapcursor",a);class c{constructor(e){this.pos=e}map(e){return new c(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return a.valid(t)?new a(t):o.LN.near(t)}}const u=(0,n.K)({ArrowLeft:h("horiz",-1),ArrowRight:h("horiz",1),ArrowUp:h("vert",-1),ArrowDown:h("vert",1)});function h(e,t){const i="vert"==e?t>0?"down":"up":t>0?"right":"left";return function(e,r,s){let n=e.selection,l=t>0?n.$to:n.$from,d=n.empty;if(n instanceof o.U3){if(!s.endOfTextblock(i)||0==l.depth)return!1;d=!1,l=e.doc.resolve(t>0?l.after():l.before())}let c=a.findGapCursorFrom(l,t,d);return!!c&&(r&&r(e.tr.setSelection(new a(c))),!0)}}function p(e,t,i){if(!e||!e.editable)return!1;let r=e.state.doc.resolve(t);if(!a.valid(r))return!1;let s=e.posAtCoords({left:i.clientX,top:i.clientY});return!(s&&s.inside>-1&&o.nh.isSelectable(e.state.doc.nodeAt(s.inside)))&&(e.dispatch(e.state.tr.setSelection(new a(r))),!0)}function f(e,t){if("insertCompositionText"!=t.inputType||!(e.state.selection instanceof a))return!1;let{$from:i}=e.state.selection,r=i.parent.contentMatchAt(i.index()).findWrapping(e.state.schema.nodes.text);if(!r)return!1;let s=l.FK.empty;for(let o=r.length-1;o>=0;o--)s=l.FK.from(r[o].createAndFill(null,s));let n=e.state.tr.replace(i.pos,i.pos,new l.Ji(s,0,0));return n.setSelection(o.U3.near(n.doc.resolve(i.pos+1))),e.dispatch(n),!1}function m(e){if(!(e.selection instanceof a))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",d.zF.create(e.doc,[d.NZ.widget(e.selection.head,t,{key:"gapcursor"})])}var g=i(4478);function v(e,t){return Object.assign(e,{meta:{package:"@milkdown/plugin-cursor",...t}}),e}const w=(0,g.Qx)({},"dropCursorConfig");v(w,{displayName:"Ctx<dropCursor>"});const C=(0,g.Gf)((e=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new o.k_({view:t=>new s(t,e)})}(e.get(w.key))));v(C,{displayName:"Prose<dropCursor>"});const y=(0,g.Gf)((()=>new o.k_({props:{decorations:m,createSelectionBetween:(e,t,i)=>t.pos==i.pos&&a.valid(i)?new a(i):null,handleClick:p,handleKeyDown:u,handleDOMEvents:{beforeinput:f}}})));v(y,{displayName:"Prose<gapCursor>"});const b=[w,C,y],x=(e,t)=>{e.config((e=>{e.update(w.key,(()=>{var e,i;return{class:"crepe-drop-cursor",width:null!=(e=null==t?void 0:t.width)?e:4,color:null!=(i=null==t?void 0:t.color)&&i}}))})).use(b)}}}]);
//# sourceMappingURL=2751.fc1837fa.chunk.js.map